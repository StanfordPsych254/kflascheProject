---
title: 'Replication: Data Analysis'
author: "Katherine Flaschen"
date: "February 20, 2016"
output: 
  html_document:
    toc: true
---

```{r Load Packages}
rm(list=ls())
library(tidyr)
library(dplyr)
library(ggplot2)
library(langcog) 
library(rjson)
```

# Data prep

```{r Data prep}
path <- "~/Desktop/Classes/Winter2015/Psych254/kflascheProject/Projects/mturk/"
files <- dir(paste0(path,"sandbox-results/"), 
             pattern = "*.json")
d.raw <- data.frame()

for (f in files) {
  jf <- paste0(path, "sandbox-results/",f)
  jd <- fromJSON(paste(readLines(jf), collapse=""))
  id <- data.frame(workerid = jd$WorkerId,
                   timer = as.numeric(jd$answers$data$primetime),
                   interesting = as.numeric(paste0(jd$answers$data$condition_god, jd$answers$data$condition_control)),
                   god_thoughts = jd$answers$data$god_thoughts,
                   god_attncheck = jd$answers$data$god_attncheck,
                   control_thoughts = jd$answers$data$control_thoughts,
                   control_attncheck = jd$answers$data$control_attncheck,
                   m_perceivedrisk1 = as.numeric(jd$answers$data$mlikelihood),
                   m_perceivedrisk2 = as.numeric(jd$answers$data$mserious),
                   m_perceivedrisk3 = as.numeric(jd$answers$data$mcope),
                   m_risk = as.numeric(jd$answers$data$mlikely),
                   wc_perceivedrisk1 = as.numeric(jd$answers$data$wclikelihood),
                   wc_perceivedrisk2 = as.numeric(jd$answers$data$wcserious),
                   wc_perceivedrisk3 = as.numeric(jd$answers$data$wccope),
                   wc_risk = as.numeric(jd$answers$data$wclikely),
                   s_perceivedrisk1 = as.numeric(jd$answers$data$slikelihood),
                   s_perceivedrisk2 = as.numeric(jd$answers$data$sserious),
                   s_perceivedrisk3 = as.numeric(jd$answers$data$s_cope),
                   s_risk = as.numeric(jd$answers$data$slikely),
                   belief_god = jd$answers$data$godbelief,
                   gender = jd$answers$data$gen,
                   age = as.numeric(jd$answers$data$age),
                   race = jd$answers$data$race_ethn,
                   english = jd$answers$data$engl,
                   check_seen = jd$answers$data$previouscheck,
                   check_hypothesis = jd$answers$data$studycheck)
  d.raw <- bind_rows(d.raw, id)
}

# Number of participants
length(unique(d.raw$workerid))
```

#Data cleanup

```{r Data cleanup}
#Clean up factor structure
d.raw$belief_god <- factor(d.raw$belief_god)
levels(d.raw$belief_god) <- c("No","Yes")

d.raw$gender <- factor(d.raw$gender)
levels(d.raw$gender) <- c("Female","Male","Other")

d.raw$english <- factor(d.raw$english)
levels(d.raw$english) <- c("No","Yes")

d.raw$check_seen <- factor(d.raw$check_seen)
levels(d.raw$check_seen) <- c("No","Yes")

#Create Condition Variable
d.raw$condition = NA
d.raw$condition[d.raw$control_thoughts==""] = "God"
d.raw$condition[d.raw$god_thoughts==""] = "Control"
d.raw$condition <- factor(d.raw$condition)

#Composite Variables
#Scenario 1: Perceived Risk
#Reverse code "cope" variable
d.raw$m_perceivedrisk3_reverse = reverse.code(-1, d.raw$m_perceivedrisk3) 
#Alpha
cor(d.raw[ ,c("m_perceivedrisk1", "m_perceivedrisk2", "m_perceivedrisk3_reverse")])
alpha_m= cbind(d.raw$m_perceivedrisk1, d.raw$m_perceivedrisk2, d.raw$m_perceivedrisk3_reverse)
ICC(alpha_m, missing=F)[[1]]$ICC[6]
#Create Variable
d.raw$m_perceivedrisk <- rowMeans(subset(d.raw, select = c("m_perceivedrisk1", "m_perceivedrisk2", "m_perceivedrisk3_reverse")), na.rm = TRUE)

#Scenario 2: Perceived Risk
#Reverse code "cope" variable
d.raw$wc_perceivedrisk3_reverse = reverse.code(-1, d.raw$wc_perceivedrisk3) 
#Alpha
cor(d.raw[ ,c("wc_perceivedrisk1", "wc_perceivedrisk2", "wc_perceivedrisk3_reverse")])
alpha_wc= cbind(d.raw$wc_perceivedrisk1, d.raw$wc_perceivedrisk2, d.raw$wc_perceivedrisk3_reverse)
ICC(alpha_wc, missing=F)[[1]]$ICC[6]
#Create Variable
d.raw$wc_perceivedrisk <- rowMeans(subset(d.raw, select = c("wc_perceivedrisk1", "wc_perceivedrisk2", "wc_perceivedrisk3_reverse")), na.rm = TRUE)

#Scenario 3: Perceived Risk
#Reverse code "cope" variable
d.raw$s_perceivedrisk3_reverse = reverse.code(-1, d.raw$s_perceivedrisk3) 
#Alpha
cor(d.raw[ ,c("s_perceivedrisk1", "s_perceivedrisk2", "s_perceivedrisk3_reverse")])
alpha_s= cbind(d.raw$s_perceivedrisk1, d.raw$s_perceivedrisk2, d.raw$s_perceivedrisk3_reverse)
ICC(alpha_s, missing=F)[[1]]$ICC[6]
#Create Variable
d.raw$s_perceivedrisk <- rowMeans(subset(d.raw, select = c("s_perceivedrisk1", "s_perceivedrisk2", "s_perceivedrisk3_reverse")), na.rm = TRUE)

#Perceived Risk Item 1: Likelihood
#Alpha
cor(d.raw[ ,c("m_perceivedrisk1", "wc_perceivedrisk1", "s_perceivedrisk1")])
alpha_risk1= cbind(d.raw$m_perceivedrisk1, d.raw$wc_perceivedrisk1, d.raw$s_perceivedrisk1)
ICC(alpha_risk1, missing=F)[[1]]$ICC[6]
#Create Variable
d.raw$likelihood_perceivedrisk <- rowMeans(subset(d.raw, select = c("m_perceivedrisk1", "wc_perceivedrisk1", "s_perceivedrisk1")), na.rm = TRUE)

#Perceived Risk Item 2: Seriousness
#Alpha
cor(d.raw[ ,c("m_perceivedrisk2", "wc_perceivedrisk2", "s_perceivedrisk2")])
alpha_risk2= cbind(d.raw$m_perceivedrisk2, d.raw$wc_perceivedrisk2, d.raw$s_perceivedrisk2)
ICC(alpha_risk2, missing=F)[[1]]$ICC[6]
#Create Variable
d.raw$serious_perceivedrisk <- rowMeans(subset(d.raw, select = c("m_perceivedrisk2", "wc_perceivedrisk2", "s_perceivedrisk2")), na.rm = TRUE)

#Perceived Risk Item 3: Cope
#Alpha
cor(d.raw[ ,c("m_perceivedrisk3_reverse", "wc_perceivedrisk3_reverse", "s_perceivedrisk3_reverse")])
alpha_risk3= cbind(d.raw$m_perceivedrisk3_reverse, d.raw$wc_perceivedrisk3_reverse, d.raw$s_perceivedrisk3_reverse)
ICC(alpha_risk3, missing=F)[[1]]$ICC[6]
#Create Variable
d.raw$cope_perceivedrisk <- rowMeans(subset(d.raw, select = c("m_perceivedrisk3_reverse", "wc_perceivedrisk3_reverse", "s_perceivedrisk3_reverse")), na.rm = TRUE)

#Perceived Risk Index: All Nine Items
#Alpha
cor(d.raw[ ,c("likelihood_perceivedrisk", "serious_perceivedrisk", "cope_perceivedrisk")])
alpha_perceivedriskindex= cbind(d.raw$likelihood_perceivedrisk, d.raw$serious_perceivedrisk, d.raw$cope_perceivedrisk)
ICC(alpha_perceivedriskindex, missing=F)[[1]]$ICC[6]
#Create Variable
d.raw$perceivedrisk_index <- rowMeans(subset(d.raw, select = c("likelihood_perceivedrisk", "serious_perceivedrisk", "cope_perceivedrisk")), na.rm = TRUE)

#Risk-Taking Index: All 3 Items
#Alpha
cor(d.raw[ ,c("m_risk", "wc_risk", "s_risk")])
alpha_risktakingindex= cbind(d.raw$m_risk, d.raw$wc_risk, d.raw$s_risk)
ICC(alpha_risktakingindex, missing=F)[[1]]$ICC[6]
#Create Variable
d.raw$risktaking_index <- rowMeans(subset(d.raw, select = c("m_risk", "wc_risk", "s_risk")), na.rm = TRUE)
```

#Exclusion Criteria
```{r Exclusions}
#Remove participants who have seen the study before
d = d.raw[d.raw$check_seen=="No",]

#Remove participants who correctly report study hypothesis under "check_hypothesis"
#d= d[-c(2),]

#Create additional dataframe with only participants who spend at least 5 seconds reading prime
d_time = d[d$timer>=5,] #Also check that this does not differ based on condition
```

#Demographics
```{r}
#Full dataframe
#Age
summary(d$age)
sd(d$age, na.rm=TRUE)

#Gender
table(d$gender)
Male = sum(d$gender=="Male")/length(d$gender)
Male
Female = sum(d$gender=="Female")/length(d$gender)
Female
Other = sum(d$gender=="Other")/length(d$gender)
Other

#Dataframe with exclusions
#Age
summary(d_time$age)
sd(d_time$age, na.rm=TRUE)

#Gender
table(d_time$gender)
Male = sum(d_time$gender=="Male")/length(d$gender)
Male
Female = sum(d_time$gender=="Female")/length(d$gender)
Female
Other = sum(d_time$gender=="Other")/length(d$gender)
Other
```

#Visualize Data: Histograms
```{r Histograms, message=FALSE, error=FALSE, warning=FALSE}
#Full dataframe
#Risk-taking
qplot(risktaking_index, data = d, binwidth=.5) + theme_bw()
#Is there a difference in risk-taking by condition?
qplot(risktaking_index, data = d, facets=~condition, binwidth=.5) + theme_bw()

#Perceived Risk
qplot(perceivedrisk_index, data = d, binwidth=.25) + theme_bw()
#Is there a difference in perceived risk by condition?
qplot(perceivedrisk_index, data = d, facets=~condition, binwidth=.25) + theme_bw()

#Dataframe with exclusions
#Risk-taking
qplot(risktaking_index, data = d_time, binwidth=.5) + theme_bw()
#Is there a difference in risk-taking by condition?
qplot(risktaking_index, data = d_time, facets=~condition, binwidth=.5) + theme_bw()

#Perceived Risk
qplot(perceivedrisk_index, data = d_time, binwidth=.25) + theme_bw()
#Is there a difference in perceived risk by condition?
qplot(perceivedrisk_index, data = d_time, facets=~condition, binwidth=.25) + theme_bw()
```
